# Тестирование Laravel Filler

Этот документ содержит инструкции по запуску тестов для пакета Laravel Filler.

## Установка зависимостей для тестирования

Перед запуском тестов убедитесь, что вы установили все необходимые зависимости:

```bash
composer install
```

## Запуск тестов

### Использование скрипта run-tests.sh

Для удобства запуска тестов в проекте есть специальный скрипт:

```bash
# Запуск всех тестов
./run-tests.sh all

# Запуск только модульных тестов
./run-tests.sh unit

# Запуск только функциональных тестов
./run-tests.sh feature

# Генерация отчета о покрытии кода
./run-tests.sh coverage

# Показать справку
./run-tests.sh help
```

### Запуск тестов вручную

Если вы предпочитаете запускать тесты напрямую через PHPUnit:

#### Запуск всех тестов

```bash
./vendor/bin/phpunit
```

#### Запуск определенного набора тестов

```bash
# Для модульных тестов
./vendor/bin/phpunit --testsuite Unit

# Для функциональных тестов
./vendor/bin/phpunit --testsuite Feature
```

### Запуск конкретного теста

Для запуска конкретного теста укажите путь к тестовому файлу:

```bash
./vendor/bin/phpunit tests/Unit/ResolverTest.php
```

Или для конкретного метода в тесте:

```bash
./vendor/bin/phpunit --filter testResolveFindExistingModelByPrimaryKey tests/Unit/ResolverTest.php
```

## Генерация отчета о покрытии кода

Для генерации отчета о покрытии кода тестами добавьте флаг `--coverage-html`:

```bash
XDEBUG_MODE=coverage ./vendor/bin/phpunit --coverage-html coverage
```

> **Примечание**: Для генерации отчета о покрытии вам потребуется расширение Xdebug.

После выполнения этой команды будет создана директория `coverage` с HTML-отчетом, который можно открыть в браузере.

## Настройка тестового окружения

### Локальное тестирование

1. Убедитесь, что у вас установлен PHP версии 8.3 или выше
2. Установите все зависимости через Composer
3. Запустите тесты с помощью PHPUnit

### Настройка для разных версий Laravel

Вы можете протестировать пакет с разными версиями Laravel, установив соответствующие зависимости:

```bash
# Для Laravel 10.x
composer require "laravel/framework:^10.0" "orchestra/testbench:^8.0" --dev

# Для Laravel 11.x
composer require "laravel/framework:^11.0" "orchestra/testbench:^9.0" --dev

# Для Laravel 12.x
composer require "laravel/framework:^12.0" "orchestra/testbench:^10.0" --dev
```

## CI/CD тестирование

Пакет настроен для автоматического тестирования с использованием GitHub Actions. Каждый пуш и пул-реквест в ветку `main` запускает тесты на следующих конфигурациях:

- PHP: 8.3, 8.4
- Laravel: 10.*, 11.*, 12.*

Файл конфигурации для GitHub Actions находится в `.github/workflows/tests.yml`.

### Просмотр результатов CI/CD

1. Перейдите в раздел "Actions" в вашем GitHub репозитории
2. Выберите нужную сборку (build)
3. Просмотрите результаты тестирования

## Структура тестов

- `tests/TestCase.php` - базовый класс для всех тестов
- `tests/database/migrations/` - миграции для тестовой базы данных
- `tests/Models/` - тестовые модели с различными типами отношений
- `tests/Unit/` - модульные тесты
- `tests/Feature/` - функциональные тесты

## Отладка тестов

Если тесты завершаются с ошибками, вы можете использовать дополнительные параметры для отладки:

```bash
# Подробный вывод
./vendor/bin/phpunit --verbose

# Включить вывод отладочной информации
./vendor/bin/phpunit --debug

# Остановиться на первой ошибке
./vendor/bin/phpunit --stop-on-failure
```

## Создание новых тестов

При добавлении новой функциональности в пакет рекомендуется создавать соответствующие тесты:

1. Модульные тесты для отдельных компонентов в директории `tests/Unit/`
2. Функциональные тесты для проверки работы функциональности в целом в директории `tests/Feature/`